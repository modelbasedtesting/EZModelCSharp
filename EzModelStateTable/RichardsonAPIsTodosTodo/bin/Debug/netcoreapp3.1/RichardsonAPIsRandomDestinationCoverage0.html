<!DOCTYPE html>
<html>
	<head>
		<style>
.parent {
    width: 96vw;
    margin: 2vw 2vw;
    position: relative;
}
.child {
	width: 100%;
	height: 100%;
	position: absolute
	top: 0;
	left: 0;
	opacity: 0.7;
}
.child-1 {
    margin-top: 12px;
}
</style>
	</head>
	<body>
<div class="parent">
<!-- Generated by graphviz -->

<svg 
 viewBox="0.00 0.00 936.00 231.92" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs><linearGradient id="greenBlueGradient" x1="0%" y1="0%" x2="100%" y2="0%" spreadMethod="pad">    <stop offset="0%" stop-color="yellowgreen" stop-opacity="1"/>    <stop offset="100%" stop-color="lightskyblue" stop-opacity="1"/></linearGradient><linearGradient id="blueGreenGradient" x1="0%" y1="0%" x2="100%" y2="0%" spreadMethod="pad">    <stop offset="0%" stop-color="lightskyblue" stop-opacity="1"/>    <stop offset="100%" stop-color="yellowgreen" stop-opacity="1"/></linearGradient></defs>
<g id="graph0" class="graph" transform="scale(0.71 0.71) rotate(0) translate(4 321.69)">
<title>state_machine</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-321.69 1310.44,-321.69 1310.44,4 -4,4"/>
<!-- Running.False, HasTodos.True, HasActiveTodos.True -->
<g id="node1" class="node">
<title>Running.False, HasTodos.True, HasActiveTodos.True</title>
<ellipse fill="none" stroke="black" cx="98.99" cy="-60.21" rx="98.99" ry="37.45"/>
<text text-anchor="middle" x="98.99" y="-71.51" font-family="Times,serif" font-size="14.00">Running.False</text>
<text text-anchor="middle" x="98.99" y="-56.51" font-family="Times,serif" font-size="14.00"> HasTodos.True</text>
<text text-anchor="middle" x="98.99" y="-41.51" font-family="Times,serif" font-size="14.00"> HasActiveTodos.True</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="node2" class="node">
<title>Running.True, HasTodos.True, HasActiveTodos.True</title>
<ellipse fill="none" stroke="black" cx="473.98" cy="-115.21" rx="98.99" ry="37.45"/>
<text text-anchor="middle" x="473.98" y="-126.51" font-family="Times,serif" font-size="14.00">Running.True</text>
<text text-anchor="middle" x="473.98" y="-111.51" font-family="Times,serif" font-size="14.00"> HasTodos.True</text>
<text text-anchor="middle" x="473.98" y="-96.51" font-family="Times,serif" font-size="14.00"> HasActiveTodos.True</text>
</g>
<!-- Running.False, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="edge1" class="edge">
<title>Running.False, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M175.62,-83.98C188.97,-87.53 202.81,-90.8 215.99,-93.21 264.62,-102.13 319.1,-107.44 365.34,-110.61"/>
<polygon fill="black" stroke="black" points="365.17,-114.1 375.38,-111.27 365.63,-107.12 365.17,-114.1"/>
<text text-anchor="middle" x="286.49" y="-113.01" font-family="Times,serif" font-size="14.00">java &#45;jar apichallenges.jar</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.False, HasTodos.True, HasActiveTodos.True -->
<g id="edge2" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.False, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M405.81,-87.83C390.04,-82.43 373.12,-77.43 356.99,-74.21 308.72,-64.57 254.4,-60.64 208.18,-59.28"/>
<polygon fill="black" stroke="black" points="208.23,-55.78 198.14,-59.02 208.05,-62.78 208.23,-55.78"/>
<text text-anchor="middle" x="286.49" y="-78.01" font-family="Times,serif" font-size="14.00">Shutdown</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="edge3" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M467.06,-152.81C467.43,-162.96 469.73,-170.69 473.98,-170.69 476.64,-170.69 478.54,-167.67 479.68,-162.93"/>
<polygon fill="black" stroke="black" points="483.18,-163.16 480.91,-152.81 476.23,-162.31 483.18,-163.16"/>
<text text-anchor="middle" x="473.98" y="-174.49" font-family="Times,serif" font-size="14.00">AddActiveTodo</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="edge4" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M460.49,-152.64C458.51,-171.65 463.01,-188.69 473.98,-188.69 482.9,-188.69 487.54,-177.44 487.91,-163.03"/>
<polygon fill="black" stroke="black" points="491.39,-162.49 487.48,-152.64 484.4,-162.78 491.39,-162.49"/>
<text text-anchor="middle" x="473.98" y="-192.49" font-family="Times,serif" font-size="14.00">AddResolvedTodo</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="edge5" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M455.42,-152.32C449.16,-179.48 455.35,-206.69 473.98,-206.69 490.29,-206.69 497.07,-185.86 494.31,-162.46"/>
<polygon fill="black" stroke="black" points="497.71,-161.57 492.55,-152.32 490.82,-162.77 497.71,-161.57"/>
<text text-anchor="middle" x="473.98" y="-210.49" font-family="Times,serif" font-size="14.00">DeleteLessThanAllTodos</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="edge7" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M451.52,-151.94C439.69,-186.78 447.17,-224.69 473.98,-224.69 498.28,-224.69 506.71,-193.56 499.27,-161.79"/>
<polygon fill="black" stroke="black" points="502.57,-160.59 496.45,-151.94 495.84,-162.52 502.57,-160.59"/>
<text text-anchor="middle" x="473.98" y="-228.49" font-family="Times,serif" font-size="14.00">ResolveLessThanAllActiveTodos</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="edge9" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M448.38,-151.75C430.21,-193.88 438.75,-242.69 473.98,-242.69 506.61,-242.69 516.34,-200.86 503.19,-161.22"/>
<polygon fill="black" stroke="black" points="506.42,-159.85 499.59,-151.75 499.87,-162.34 506.42,-159.85"/>
<text text-anchor="middle" x="473.98" y="-246.49" font-family="Times,serif" font-size="14.00">ActivateAnyResolvedTodos</text>
</g>
<!-- Running.True, HasTodos.False, HasActiveTodos.False -->
<g id="node3" class="node">
<title>Running.True, HasTodos.False, HasActiveTodos.False</title>
<ellipse fill="none" stroke="black" cx="1205.33" cy="-101.21" rx="101.23" ry="37.45"/>
<text text-anchor="middle" x="1205.33" y="-112.51" font-family="Times,serif" font-size="14.00">Running.True</text>
<text text-anchor="middle" x="1205.33" y="-97.51" font-family="Times,serif" font-size="14.00"> HasTodos.False</text>
<text text-anchor="middle" x="1205.33" y="-82.51" font-family="Times,serif" font-size="14.00"> HasActiveTodos.False</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.False, HasActiveTodos.False -->
<g id="edge6" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.False, HasActiveTodos.False</title>
<path fill="none" stroke="black" d="M538.69,-143.64C555.41,-150.07 573.62,-156.18 590.98,-160.21 753.11,-197.92 800.62,-200.1 965.21,-175.21 1020.27,-166.89 1080.12,-148.36 1126.17,-131.92"/>
<polygon fill="black" stroke="black" points="1127.56,-135.14 1135.78,-128.45 1125.18,-128.56 1127.56,-135.14"/>
<text text-anchor="middle" x="864.1" y="-195.01" font-family="Times,serif" font-size="14.00">DeleteAllTodos</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.False -->
<g id="node4" class="node">
<title>Running.True, HasTodos.True, HasActiveTodos.False</title>
<ellipse fill="none" stroke="black" cx="864.1" cy="-63.21" rx="101.23" ry="37.45"/>
<text text-anchor="middle" x="864.1" y="-74.51" font-family="Times,serif" font-size="14.00">Running.True</text>
<text text-anchor="middle" x="864.1" y="-59.51" font-family="Times,serif" font-size="14.00"> HasTodos.True</text>
<text text-anchor="middle" x="864.1" y="-44.51" font-family="Times,serif" font-size="14.00"> HasActiveTodos.False</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.False -->
<g id="edge8" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.True&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.False</title>
<path fill="none" stroke="black" d="M559.99,-133.86C613.86,-142.37 684.53,-147.37 744.98,-131.21 767.38,-125.23 789.94,-113.86 809.25,-102.11"/>
<polygon fill="black" stroke="black" points="811.27,-104.97 817.88,-96.7 807.55,-99.04 811.27,-104.97"/>
<text text-anchor="middle" x="667.98" y="-145.01" font-family="Times,serif" font-size="14.00">ResolveAllActiveTodos</text>
</g>
<!-- Running.True, HasTodos.False, HasActiveTodos.False&#45;&gt;Running.False, HasTodos.True, HasActiveTodos.True -->
<g id="edge10" class="edge">
<title>Running.True, HasTodos.False, HasActiveTodos.False&#45;&gt;Running.False, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M1142.08,-71.86C1094.79,-51.43 1027.48,-26.28 965.21,-17.21 689.7,22.9 360.2,-17.49 198.88,-42.92"/>
<polygon fill="black" stroke="black" points="198.29,-39.47 188.97,-44.5 199.39,-46.39 198.29,-39.47"/>
<text text-anchor="middle" x="667.98" y="-7.01" font-family="Times,serif" font-size="14.00">Shutdown</text>
</g>
<!-- Running.True, HasTodos.False, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="edge11" class="edge">
<title>Running.True, HasTodos.False, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M1156.41,-134.2C1135.51,-147.58 1110.31,-162.39 1086.21,-173.21 1034.91,-196.25 1020.83,-201.9 965.21,-210.21 800.43,-234.84 747.81,-244.48 590.98,-188.21 568.54,-180.16 545.91,-167.24 526.66,-154.48"/>
<polygon fill="black" stroke="black" points="528.59,-151.56 518.35,-148.84 524.66,-157.35 528.59,-151.56"/>
<text text-anchor="middle" x="864.1" y="-233.01" font-family="Times,serif" font-size="14.00">AddActiveTodo</text>
</g>
<!-- Running.True, HasTodos.False, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.False -->
<g id="edge12" class="edge">
<title>Running.True, HasTodos.False, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.False</title>
<path fill="none" stroke="black" d="M1132.68,-75.03C1117.53,-70.55 1101.5,-66.59 1086.21,-64.21 1049.98,-58.59 1010,-57.02 974.12,-57.27"/>
<polygon fill="black" stroke="black" points="974.07,-53.77 964.11,-57.38 974.15,-60.77 974.07,-53.77"/>
<text text-anchor="middle" x="1034.71" y="-68.01" font-family="Times,serif" font-size="14.00">AddResolvedTodo</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.False, HasTodos.True, HasActiveTodos.True -->
<g id="edge13" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.False, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M763.54,-58.86C757.26,-58.63 751.03,-58.41 744.98,-58.21 580.62,-52.82 539.43,-52.42 374.99,-54.21 320.04,-54.81 258.93,-56.09 208.3,-57.3"/>
<polygon fill="black" stroke="black" points="207.9,-53.81 197.99,-57.56 208.07,-60.81 207.9,-53.81"/>
<text text-anchor="middle" x="473.98" y="-58.01" font-family="Times,serif" font-size="14.00">Shutdown</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="edge14" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M782.78,-85.52C770.2,-88.46 757.29,-91.16 744.98,-93.21 691.92,-102.05 632.38,-107.38 582.74,-110.58"/>
<polygon fill="black" stroke="black" points="582.39,-107.09 572.63,-111.21 582.83,-114.08 582.39,-107.09"/>
<text text-anchor="middle" x="667.98" y="-113.01" font-family="Times,serif" font-size="14.00">AddActiveTodo</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True -->
<g id="edge18" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.True</title>
<path fill="none" stroke="black" d="M763.08,-60.14C711.29,-60.34 647.28,-63.38 590.98,-74.21 578.03,-76.71 564.57,-80.38 551.61,-84.52"/>
<polygon fill="black" stroke="black" points="550.21,-81.3 541.82,-87.77 552.41,-87.95 550.21,-81.3"/>
<text text-anchor="middle" x="667.98" y="-78.01" font-family="Times,serif" font-size="14.00">ActivateAnyResolvedTodos</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.False, HasActiveTodos.False -->
<g id="edge17" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.False, HasActiveTodos.False</title>
<path fill="none" stroke="black" d="M959.19,-76.26C967.31,-77.3 975.4,-78.3 983.21,-79.21 1020.25,-83.56 1060.84,-87.76 1097.02,-91.31"/>
<polygon fill="black" stroke="black" points="1096.81,-94.8 1107.1,-92.29 1097.49,-87.84 1096.81,-94.8"/>
<text text-anchor="middle" x="1034.71" y="-94.01" font-family="Times,serif" font-size="14.00">DeleteAllTodos</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.False -->
<g id="edge15" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.False</title>
<path fill="none" stroke="black" d="M848.24,-100.29C848.93,-110.7 854.22,-118.69 864.1,-118.69 870.42,-118.69 874.87,-115.41 877.43,-110.32"/>
<polygon fill="black" stroke="black" points="880.9,-110.84 879.95,-100.29 874.12,-109.13 880.9,-110.84"/>
<text text-anchor="middle" x="864.1" y="-122.49" font-family="Times,serif" font-size="14.00">AddResolvedTodo</text>
</g>
<!-- Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.False -->
<g id="edge16" class="edge">
<title>Running.True, HasTodos.True, HasActiveTodos.False&#45;&gt;Running.True, HasTodos.True, HasActiveTodos.False</title>
<path fill="none" stroke="black" d="M833.64,-99.13C828.21,-118.73 838.36,-136.69 864.1,-136.69 885.2,-136.69 895.83,-124.61 895.97,-109.44"/>
<polygon fill="black" stroke="black" points="899.38,-108.56 894.55,-99.13 892.45,-109.51 899.38,-108.56"/>
<text text-anchor="middle" x="864.1" y="-140.49" font-family="Times,serif" font-size="14.00">DeleteLessThanAllTodos</text>
</g>
</g>
</svg>
<div class="child">
    <button onclick="traversalStepBack()">Back</button>
    <button onclick="traversalStepForward()">Forward</button>
    <button onclick="startTraversal()">Start</button>
    <input id="step" type="text" length="10" size="10" value="0" />
    <button onclick="stopTraversal()">Stop</button>
    <text id="edge"> </text>
</div>
<div class="child child-1">
    <text id="transitionFloor"> </text>
</div>
<div class="child child-1">
    <button onclick="reset()">RESET</button>

<text id="wallTime">Traversal wall time 0.030 seconds</text>
</div>
</div>
<script>
var step = -1; // Because step is an index into an array.

const actionNames = ["java -jar apichallenges.jar","Shutdown","AddActiveTodo","AddResolvedTodo","DeleteLessThanAllTodos","DeleteAllTodos","ResolveLessThanAllActiveTodos","ResolveAllActiveTodos","ActivateAnyResolvedTodos"];
 
const transitionActions = [0,1,2,3,4,5,6,7,8,1,2,3,1,2,3,4,5,8];
 
const transitionHitCounts = new Array(18).fill(0);
 
const nodeCount = 4;
 
const traversedEdge = [0,3,2,6,1,0,7,16,9,0,7,14,15,13,4,8,5,11,12,0,5,10,7,17,6,3,2,8,4,1,0,7,14,16,11,17,5,9,0,5,10,7,12,0,7,15,13,3,1,0,4,8,6,2,7,12,0,7,14,15,16,9,0,5,11,17,7,13,5,10];
 
const pathEdges = [[0],[3],[2],[6],[1],[0,7,16],[0,7,16],[0,7,16],[9],[0,7,14],[0,7,14],[0,7,14],[15],[13],[4],[8],[5],[11],[12],[0,5,10],[0,5,10],[0,5,10],[7,17],[7,17],[6],[3],[2],[8],[4],[1],[0,7,14],[0,7,14],[0,7,14],[16],[11],[17],[5,9],[5,9],[0,5,10],[0,5,10],[0,5,10],[7,12],[7,12],[0,7,15],[0,7,15],[0,7,15],[13],[3],[1],[0,4],[0,4],[8],[6],[2],[7,12],[7,12],[0,7,14],[0,7,14],[0,7,14],[15],[16],[9],[0,5,11],[0,5,11],[0,5,11],[17],[7,13],[7,13],[5,10],[5,10]];
 
const pathNodes = [[1],[1],[1],[1],[0],[0,1,3,2],[0,1,3,2],[0,1,3,2],[0],[0,1,3,3],[0,1,3,3],[0,1,3,3],[3],[1],[1],[1],[2],[3],[0],[0,1,2,1],[0,1,2,1],[0,1,2,1],[1,3,1],[1,3,1],[1],[1],[1],[1],[1],[0],[0,1,3,3],[0,1,3,3],[0,1,3,3],[2],[3],[1],[1,2,0],[1,2,0],[0,1,2,1],[0,1,2,1],[0,1,2,1],[1,3,0],[1,3,0],[0,1,3,3],[0,1,3,3],[0,1,3,3],[1],[1],[0],[0,1,1],[0,1,1],[1],[1],[1],[1,3,0],[1,3,0],[0,1,3,3],[0,1,3,3],[0,1,3,3],[3],[2],[0],[0,1,2,3],[0,1,2,3],[0,1,2,3],[1],[1,3,1],[1,3,1],[1,2,1],[1,2,1]];
 
const startNode = [0,1,1,1,1,0,1,3,2,0,1,3,3,3,1,1,1,2,3,0,1,2,1,3,1,1,1,1,1,1,0,1,3,3,2,3,1,2,0,1,2,1,3,0,1,3,3,1,1,0,1,1,1,1,1,3,0,1,3,3,3,2,0,1,2,3,1,3,1,2];
 
const pathEndNode = [1,1,1,1,0,2,2,2,0,3,3,3,3,1,1,1,2,3,0,1,1,1,1,1,1,1,1,1,1,0,3,3,3,2,3,1,0,0,1,1,1,0,0,3,3,3,1,1,0,1,1,1,1,1,0,0,3,3,3,3,2,0,3,3,3,1,1,1,1,1];
 
var c = 0;
var t;
var timer_is_on = 0;

var coverageFloor;

const stepElemSize = 2*Math.floor(Math.log10(traversedEdge.length)) + 3;
var stepElem = document.getElementById("step");
stepElem.setAttribute("length", stepElemSize);
stepElem.setAttribute("size", stepElemSize);
setStepText();
assessCoverageFloor();

function setTransitionFloorText() {
	document.getElementById("transitionFloor").innerHTML = "Transition coverage floor: " + coverageFloor;
}

function timedTraversal() {
  c = c + 1;
  traversalStepForward();
  if (timer_is_on)
  {
	  t = setTimeout(timedTraversal, 1);
  }
}

function startTraversal() {
  if (!timer_is_on) {
    timer_is_on = 1;
    timedTraversal();
  }
}

function stopTraversal() {
  clearTimeout(t);
  timer_is_on = 0;
}

function reset() {
	timer_is_on = 0;
	clearTimeout(t);

    document.getElementById("edge").innerHTML = " ";
    for (var i = 0; i < transitionHitCounts.length; i++)
    {
        transitionHitCounts[i] = 0;
    }
    refreshGraphics("black");

    step = -1; // Because step is an index into an array.
    setStepText();
    assessCoverageFloor();
}

function setStepText() {
	document.getElementById("step").value = (step+1) + "/" + traversedEdge.length;
}

function refreshGraphics(refreshColor) {
    // Set all path and polygon strokes and stroke-width values to 2,
    // and stroke color to black.  Set the fill to none on all graph nodes.

	// Walk backwards from the current step and set a 
	// rendered flag on each transition as it is encountered.
	// Do not render a transition that has rendered==true.
	var rendered = new Array(transitionHitCounts.length).fill(false);
    var edgesToRender = traversedEdge.length;

    // Before we walk backwards, clear each edge of the lookahead path
    // that is beyond the present edge.
    if (step > -1 && step < traversedEdge.length)
    {
        for (var i=1; i < pathEdges[step].length; i++)
        {
            var index = pathEdges[step][i];
            var hitColor = getHitColor(transitionHitCounts[index]);

            rendered[index] = true;
            edgesToRender--;

            var svgEdge = index + 1;
            var edge = document.getElementById("edge" + svgEdge.toString());
            var path = edge.getElementsByTagName("path");
            if (path.length > 0)
            {
                path[0].setAttribute("stroke-width", "3");
                path[0].setAttribute("stroke", hitColor);
            }
            var poly = edge.getElementsByTagName("polygon");
            if (poly.length > 0)
            {
                poly[0].setAttribute("stroke-width", "3");
                poly[0].setAttribute("fill", hitColor);
                poly[0].setAttribute("stroke", hitColor);
            }
        }
    }

    for (var i = step; i >= 0 && edgesToRender > 0; i--)
    {
    	var edgeIndex = traversedEdge[i];
    	if (rendered[edgeIndex])
    	{
    		continue;
    	}

        // When there are many steps, we will cover all the edges before we
        // get through all the steps, and we can stop looking for edges to
        // paint.  So count down the edges to render to zero, and stop.
        edgesToRender--; 

    	rendered[edgeIndex] = true;
        var hitCount = transitionHitCounts[edgeIndex];
        var hitColor = getHitColor(hitCount);
        var action = actionNames[transitionActions[edgeIndex]];
        var svgEdge = traversedEdge[i] + 1;
        var edge = document.getElementById("edge" + svgEdge.toString());
        var path = edge.getElementsByTagName("path");
        if (path.length > 0)
        {   // for hitCount 0 set the stroke width to 1.
            path[0].setAttribute("stroke-width", hitCount == 0 ? 1 : refreshColor == null ? "3" : "1");
            path[0].setAttribute("stroke", refreshColor == null ? hitColor : refreshColor);
        }
        var poly = edge.getElementsByTagName("polygon");
        if (poly.length > 0)
        {   // for hitCount 0 set the stroke width to 1.
            poly[0].setAttribute("stroke-width", hitCount == 0 ? 1 : refreshColor == null ? "3" : "1");
            poly[0].setAttribute("fill", refreshColor == null ? hitColor : refreshColor);
            poly[0].setAttribute("stroke", refreshColor == null ? hitColor : refreshColor);
        }
        var text = edge.getElementsByTagName("text");
        if (text.length > 0)
        {
            if (hitCount > 0)
            {
                action += " (" + hitCount.toString() + ")";
            }
            text[0].innerHTML = action;
        }
    }

    // Clear all the nodes.
    for (var i = 1; i <= nodeCount; i++)
    {
        var node = document.getElementById("node" + i.toString());
        var ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            ellipse[0].setAttribute("fill", "none");
        }
    }
}

function traversalStepBack() {
	stopTraversal();
    if (step - 1 < -1)
    {
        return;
    }

    if (step > -1)
    {
        transitionHitCounts[traversedEdge[step]]--;
        if (transitionHitCounts[traversedEdge[step]] < coverageFloor)
        {
        	coverageFloor = transitionHitCounts[traversedEdge[step]];
        	setTransitionFloorText();
        }
        refreshGraphics();
    }
    step--;
    traversalStepCommon();
}

function traversalStepForward() {
    if (step + 1 >= traversedEdge.length)
    {
        stopTraversal(); // in case the traversal was running.  Now we can use the back button.
        return;
    }
    refreshGraphics();
    step++;
    transitionHitCounts[traversedEdge[step]]++;
    assessCoverageFloor();
    traversalStepCommon();
}


function assessCoverageFloor()
{
	var floor = 2000000000;
	for (var i=0; i < transitionHitCounts.length; i++)
	{
		if (transitionHitCounts[i] < floor)
		{
			floor = transitionHitCounts[i];
		}
	}
	if (floor != coverageFloor)
	{
		coverageFloor = floor;
		setTransitionFloorText();
	}
}

function traversalStepCommon() {
    setStepText();

    if (step == -1)
    {
        return; // no work to do because we are at the initial state.
    }

    // Now paint the current path and nodes in light grey
    for (var i = 0; i < pathEdges[step].length; i++)
    {
        var svgEdge = pathEdges[step][i] + 1;
        var edge = document.getElementById("edge" + svgEdge.toString());
        var path = edge.getElementsByTagName("path");
        if (path.length > 0)
        {
            path[0].setAttribute("stroke-width", "15");
            path[0].setAttribute("stroke", "lightgrey");
        }
        var poly = edge.getElementsByTagName("polygon");
        if (poly.length > 0)
        {
            poly[0].setAttribute("stroke-width", "15");
            poly[0].setAttribute("fill", "lightgrey");
            poly[0].setAttribute("stroke", "lightgrey");
        }
    }
    for (var i = 0; i < pathNodes[step].length; i++)
    {
        var svgNode = pathNodes[step][i] + 1;
        var node = document.getElementById("node" + svgNode.toString());
        var ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            ellipse[0].setAttribute("fill", "lightgrey");
        }
    }

    // Finally, paint the current transition in fat red, 
    // paint the start node of the path in green, and 
    // paint the end node of the path in cyan.   
    // NOTE: Doing a gradient in svg is very difficult 
    // because of the calculations.  Look at that later, 
    // for when the start and end node of the path are
    // the same. 
    document.getElementById("edge").innerHTML = actionNames[transitionActions[traversedEdge[step]]];
    svgEdge = traversedEdge[step] + 1;
    edge = document.getElementById("edge" + svgEdge.toString());
    var path = edge.getElementsByTagName("path");
    if (path.length > 0)
    {
        path[0].setAttribute("stroke-width", "15");
        var hitCount = transitionHitCounts[traversedEdge[step]];
        var color = getHitColor(hitCount);
        path[0].setAttribute("stroke", "url(#greenBlueGradient)");
    }
    var poly = edge.getElementsByTagName("polygon");
    if (poly.length > 0)
    {
        poly[0].setAttribute("stroke-width", "15");
        poly[0].setAttribute("fill", "url(#greenBlueGradient)");
        poly[0].setAttribute("stroke", "url(#greenBlueGradient)");
    }

    if (startNode[step] == pathEndNode[step])
    {
    	var nodeNum = startNode[step] + 1;
    	var node = document.getElementById("node" + nodeNum.toString());

        var ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            if (pathEdges[step].length == 1)
            {
                // This is a self loop with the path coming out of the 
                // start node, going into the end node, so make the 
                // node blue to green.
                ellipse[0].setAttribute("fill", "url(#blueGreenGradient)");
            }
            else
            {
                // This is probably the path coming into the end node,
                // so make the node green to blue.
                ellipse[0].setAttribute("fill", "url(#greenBlueGradient)");

            }
        }
    }
    else
    {
        var start = startNode[step] + 1;
        var node = document.getElementById("node" + start.toString());
        var ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            ellipse[0].setAttribute("fill", "yellowgreen");
        }

        var pathEnd = pathEndNode[step] + 1;
        node = document.getElementById("node" + pathEnd.toString());
        ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            ellipse[0].setAttribute("fill", "lightskyblue");
        }
    }
}

function getHitColor(hitCount) {
    switch (hitCount%19)
    {
        case 0:
            if (hitCount != 0)
            {
                return "#BFBF3F";
            }
            return "#000000";
        case 1:
            return "#DF0000";
        case 2:
            return "#00DF00";
        case 3:
            return "#0000DF";
        case 4:
            return "#9F9F00";
        case 5:
            return "#009F9F";
        case 6:
            return "#9F009F";
        case 7:
            return "#2F7F7F";
        case 8:
            return "#7F2F7F";
        case 9:
            return "#7F7F2F";
        case 10:
            return "#3F3FAF";
        case 11:
            return "#AF3F3F";
        case 12:
            return "#3FAF3F";
        case 13:
            return "#AF1F77";
        case 14:
            return "#1FAF77";
        case 15:
            return "#1F77AF";
        case 16:
            return "#771FAF";
        case 17:
            return "#77AF1F";
        default:
            return "#FF1F1F";
    }
}
</script>
</body>
</html>
