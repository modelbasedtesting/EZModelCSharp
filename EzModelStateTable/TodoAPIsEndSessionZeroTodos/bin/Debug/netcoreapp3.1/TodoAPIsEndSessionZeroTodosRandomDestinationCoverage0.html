<!DOCTYPE html>
<html>
	<head>
		<style>
input[type="range"] {
	width:240px;
}
TD { 
	font-family: Arial; 
	font-size: 10pt; 
}
TH {
	font-family: Arial;
	font-size: 12pt;
}
</style>
	</head>
	<body onresize="updateWindowDimensions()">
    <table border="0" width="100%" height="100%">
		<tr>
			<th colspan="2" id="selectedSvgElementInfo" style="height:20px; color:#e00000"></th> 
		</tr>
		<tr>
			<td width="50">
				<table border="0">
					<tr><td style="text-align:right">18</td><td style="width:50%; background-color:#FF7F7F"></td></tr> 
					<tr><td style="text-align:right">17</td><td style="width:50%; background-color:#97FF2F"></td></tr>
					<tr><td style="text-align:right">16</td><td style="width:50%; background-color:#771FAF"></td></tr>
					<tr><td style="text-align:right">15</td><td style="width:50%; background-color:#8FCF27"></td></tr>
					<tr><td style="text-align:right">14</td><td style="width:50%; background-color:#4F7FEF"></td></tr>
					<tr><td style="text-align:right">13</td><td style="width:50%; background-color:#3FAF3F"></td></tr>
					<tr><td style="text-align:right">12</td><td style="width:50%; background-color:#A71770"></td></tr>
					<tr><td style="text-align:right">11</td><td style="width:50%; background-color:#008F00"></td></tr>
					<tr><td style="text-align:right">10</td><td style="width:50%; background-color:#BF4F4F"></td></tr>
					<tr><td style="text-align:right">9</td><td style="width:50%; background-color:#3737AF"></td></tr>
					<tr><td style="text-align:right">8</td><td style="width:50%; background-color:#77EF77"></td></tr>
					<tr><td style="text-align:right">7</td><td style="width:50%; background-color:#8F008F"></td></tr>
					<tr><td style="text-align:right">6</td><td style="width:50%; background-color:#EFD700"></td></tr>
					<tr><td style="text-align:right">5</td><td style="width:50%; background-color:#0000DF"></td></tr>
					<tr><td style="text-align:right">4</td><td style="width:50%; background-color:#00DF00"></td></tr>
					<tr><td style="text-align:right">3</td><td style="width:50%; background-color:#FFAF00"></td></tr>
					<tr><td style="text-align:right">2</td><td style="width:50%; background-color:#00AFFF"></td></tr>
					<tr><td style="text-align:right">1</td><td style="width:50%; background-color:#DF00DF"></td></tr>
					<tr><td style="text-align:right">0</td><td style="width:50%; background-color:#000000"></td></tr>
				</table>
			</td>
			<td id="mainBox">
				<table border="1" rules="none" width="100%" height="100%">
					<tr>
						<td>
<!-- Generated by graphviz -->

<svg id="svgOuter" onmousedown="svgMouseDown(evt)" onmouseup="svgMouseUp(evt)" onmouseleave="svgMouseLeave(evt)" onwheel="svgMouseWheel(evt)" 
 viewBox="0.00 0.00 936.00 216.47" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs><linearGradient id="greenBlueGradient" x1="0%" y1="0%" x2="100%" y2="0%" spreadMethod="pad">    <stop offset="0%" stop-color="yellowgreen" stop-opacity="1"/>    <stop offset="100%" stop-color="lightskyblue" stop-opacity="1"/></linearGradient><linearGradient id="blueGreenGradient" x1="0%" y1="0%" x2="100%" y2="0%" spreadMethod="pad">    <stop offset="0%" stop-color="lightskyblue" stop-opacity="1"/>    <stop offset="100%" stop-color="yellowgreen" stop-opacity="1"/></linearGradient></defs>
<g id="graph0" class="graph" transform="scale(0.43 0.43) rotate(0) translate(4 502)">
<title>state_machine</title>
<g id="node0" class="node">
<title>InSession.False, ActiveTodos.0, ResolvedTodos.0</title>
<ellipse fill="#f7f5eb" onclick="attr(evt)" stroke="black" cx="78.49" cy="-156" rx="78.48" ry="37.45"/>
<text text-anchor="middle" onclick="attr(evt)" x="78.49" y="-167.3" font-family="Times,serif" font-size="14.00">InSession.False</text>
<text text-anchor="middle" onclick="attr(evt)" x="78.49" y="-152.3" font-family="Times,serif" font-size="14.00">ActiveTodos.0</text>
<text text-anchor="middle" onclick="attr(evt)" x="78.49" y="-137.3" font-family="Times,serif" font-size="14.00">ResolvedTodos.0</text>
</g>
<g id="node1" class="node">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.0</title>
<ellipse fill="#f7f5eb" onclick="attr(evt)" stroke="black" cx="362.47" cy="-293" rx="78.48" ry="37.45"/>
<text text-anchor="middle" onclick="attr(evt)" x="362.47" y="-304.3" font-family="Times,serif" font-size="14.00">InSession.True</text>
<text text-anchor="middle" onclick="attr(evt)" x="362.47" y="-289.3" font-family="Times,serif" font-size="14.00">ActiveTodos.0</text>
<text text-anchor="middle" onclick="attr(evt)" x="362.47" y="-274.3" font-family="Times,serif" font-size="14.00">ResolvedTodos.0</text>
</g>
<g id="edge24" class="edge">
<title>InSession.False, ActiveTodos.0, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M122.1,-187.23C138.08,-197.84 156.78,-209.02 174.98,-217 213.29,-233.79 227.11,-225.55 265.98,-241 278.68,-246.05 291.84,-252.4 304.18,-258.92"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="302.54,-262.01 313,-263.68 305.86,-255.85 302.54,-262.01"/>
<text text-anchor="middle" onclick="attr(evt)" x="220.48" y="-244.8" font-family="Times,serif" font-size="14.00">Start Session (0)</text>
</g>
<g id="edge21" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.0&#45;&gt;InSession.False, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M283.78,-290.49C248.78,-286.61 207.99,-278.1 174.98,-260 148.77,-245.63 125.87,-221.36 109.07,-199.88"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="111.77,-197.65 102.93,-191.8 106.2,-201.88 111.77,-197.65"/>
<text text-anchor="middle" onclick="attr(evt)" x="220.48" y="-290.8" font-family="Times,serif" font-size="14.00">End Session (0)</text>
</g>
<g id="edge28" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M349.41,-330.07C349.98,-340.49 354.33,-348.48 362.47,-348.48 367.68,-348.48 371.34,-345.2 373.44,-340.1"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="376.92,-340.58 375.53,-330.07 370.07,-339.15 376.92,-340.58"/>
<text text-anchor="middle" onclick="attr(evt)" x="362.47" y="-352.28" font-family="Times,serif" font-size="14.00">Resolve an Active Todo (0)</text>
</g>
<g id="edge30" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M337.47,-328.53C332.81,-348.29 341.14,-366.48 362.47,-366.48 380.13,-366.48 388.88,-354 388.71,-338.5"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="392.18,-338.02 387.46,-328.53 385.24,-338.89 392.18,-338.02"/>
<text text-anchor="middle" onclick="attr(evt)" x="362.47" y="-370.28" font-family="Times,serif" font-size="14.00">Get a Todo (0)</text>
</g>
<g id="node2" class="node">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.0</title>
<ellipse fill="#f7f5eb" onclick="attr(evt)" stroke="black" cx="2101.38" cy="-321" rx="78.48" ry="37.45"/>
<text text-anchor="middle" onclick="attr(evt)" x="2101.38" y="-332.3" font-family="Times,serif" font-size="14.00">InSession.True</text>
<text text-anchor="middle" onclick="attr(evt)" x="2101.38" y="-317.3" font-family="Times,serif" font-size="14.00">ActiveTodos.1</text>
<text text-anchor="middle" onclick="attr(evt)" x="2101.38" y="-302.3" font-family="Times,serif" font-size="14.00">ResolvedTodos.0</text>
</g>
<g id="edge23" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M384.61,-329.12C401.6,-355.16 427.74,-389.23 458.96,-410 554.08,-473.29 591.19,-483 705.44,-483 705.44,-483 705.44,-483 1766.4,-483 1874.27,-483 1912.17,-493.12 2004.89,-438 2034.02,-420.68 2058.08,-391.02 2074.76,-365.9"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="2077.87,-367.53 2080.35,-357.23 2071.99,-363.74 2077.87,-367.53"/>
<text text-anchor="middle" onclick="attr(evt)" x="1227.91" y="-486.8" font-family="Times,serif" font-size="14.00">Add an Active Todo (0)</text>
</g>
<g id="node3" class="node">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.1</title>
<ellipse fill="#f7f5eb" onclick="attr(evt)" stroke="black" cx="706.44" cy="-257" rx="78.48" ry="37.45"/>
<text text-anchor="middle" onclick="attr(evt)" x="706.44" y="-268.3" font-family="Times,serif" font-size="14.00">InSession.True</text>
<text text-anchor="middle" onclick="attr(evt)" x="706.44" y="-253.3" font-family="Times,serif" font-size="14.00">ActiveTodos.0</text>
<text text-anchor="middle" onclick="attr(evt)" x="706.44" y="-238.3" font-family="Times,serif" font-size="14.00">ResolvedTodos.1</text>
</g>
<g id="edge22" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M440.22,-287.87C488.93,-284.26 553.25,-278.86 609.96,-272 613.87,-271.53 617.88,-271.01 621.92,-270.47"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="622.59,-273.91 632.01,-269.07 621.62,-266.98 622.59,-273.91"/>
<text text-anchor="middle" onclick="attr(evt)" x="534.46" y="-289.8" font-family="Times,serif" font-size="14.00">Add a Resolved Todo (0)</text>
</g>
<g id="edge16" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.0&#45;&gt;InSession.False, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M2094.04,-283.66C2083.71,-233.37 2058.71,-143.89 2004.89,-89 1925.68,-8.22 1879.53,0 1766.4,0 361.47,0 361.47,0 361.47,0 266.21,0 172.93,-69 121.14,-115.22"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="118.55,-112.84 113.49,-122.15 123.25,-118.03 118.55,-112.84"/>
<text text-anchor="middle" onclick="attr(evt)" x="1050.42" y="-3.8" font-family="Times,serif" font-size="14.00">End Session (0)</text>
</g>
<g id="edge18" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M2069.6,-355.55C2052.3,-372.81 2029.3,-392.42 2004.89,-404 1907.72,-450.09 1873.95,-445 1766.4,-445 705.44,-445 705.44,-445 705.44,-445 593.21,-445 476.73,-375.79 412.84,-330.77"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="414.73,-327.82 404.56,-324.86 410.66,-333.52 414.73,-327.82"/>
<text text-anchor="middle" onclick="attr(evt)" x="1227.91" y="-448.8" font-family="Times,serif" font-size="14.00">Delete an Active Todo (0)</text>
</g>
<g id="edge29" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M2070.25,-355.67C2070.25,-367.23 2080.63,-376.48 2101.38,-376.48 2115.64,-376.48 2125,-372.11 2129.46,-365.62"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="2132.93,-366.26 2132.5,-355.67 2126.23,-364.21 2132.93,-366.26"/>
<text text-anchor="middle" onclick="attr(evt)" x="2101.38" y="-380.28" font-family="Times,serif" font-size="14.00">Get Todos List (0)</text>
</g>
<g id="edge17" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M2033.18,-339.81C2023.74,-341.89 2014.12,-343.71 2004.89,-345 1933.99,-354.89 1915.47,-348.89 1843.89,-350 1455.79,-356.02 1358.97,-330.29 971.93,-301 896.78,-295.31 876.89,-301.5 802.93,-287 795.44,-285.53 787.7,-283.68 780.03,-281.63"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="780.94,-278.25 770.37,-278.93 779.06,-284.99 780.94,-278.25"/>
<text text-anchor="middle" onclick="attr(evt)" x="1407.91" y="-347.8" font-family="Times,serif" font-size="14.00">Resolve an Active Todo (0)</text>
</g>
<g id="node4" class="node">
<title>InSession.True, ActiveTodos.2, ResolvedTodos.0</title>
<ellipse fill="#f7f5eb" onclick="attr(evt)" stroke="black" cx="1765.4" cy="-65" rx="78.48" ry="37.45"/>
<text text-anchor="middle" onclick="attr(evt)" x="1765.4" y="-76.3" font-family="Times,serif" font-size="14.00">InSession.True</text>
<text text-anchor="middle" onclick="attr(evt)" x="1765.4" y="-61.3" font-family="Times,serif" font-size="14.00">ActiveTodos.2</text>
<text text-anchor="middle" onclick="attr(evt)" x="1765.4" y="-46.3" font-family="Times,serif" font-size="14.00">ResolvedTodos.0</text>
</g>
<g id="edge20" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.2, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M2065.71,-287.33C2048.43,-271.8 2026.61,-253.97 2004.89,-241 1946.15,-205.92 1916.89,-224.69 1861.89,-184 1834.65,-163.85 1810.79,-134.12 1793.73,-109.42"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1796.49,-107.25 1787.99,-100.92 1790.69,-111.17 1796.49,-107.25"/>
<text text-anchor="middle" onclick="attr(evt)" x="1933.39" y="-244.8" font-family="Times,serif" font-size="14.00">Add an Active Todo (0)</text>
</g>
<g id="node5" class="node">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.1</title>
<ellipse fill="#f7f5eb" onclick="attr(evt)" stroke="black" cx="1407.91" cy="-222" rx="78.48" ry="37.45"/>
<text text-anchor="middle" onclick="attr(evt)" x="1407.91" y="-233.3" font-family="Times,serif" font-size="14.00">InSession.True</text>
<text text-anchor="middle" onclick="attr(evt)" x="1407.91" y="-218.3" font-family="Times,serif" font-size="14.00">ActiveTodos.1</text>
<text text-anchor="middle" onclick="attr(evt)" x="1407.91" y="-203.3" font-family="Times,serif" font-size="14.00">ResolvedTodos.1</text>
</g>
<g id="edge19" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M2025.95,-310.34C1896.23,-291.77 1629.57,-253.59 1493.22,-234.07"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1493.63,-230.59 1483.24,-232.64 1492.64,-237.52 1493.63,-230.59"/>
<text text-anchor="middle" onclick="attr(evt)" x="1765.4" y="-285.8" font-family="Times,serif" font-size="14.00">Add a Resolved Todo (0)</text>
</g>
<g id="edge11" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.1&#45;&gt;InSession.False, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M631.59,-245.08C514.37,-226.17 286.42,-189.39 163.27,-169.52"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="163.56,-166.02 153.13,-167.88 162.45,-172.93 163.56,-166.02"/>
<text text-anchor="middle" onclick="attr(evt)" x="362.47" y="-216.8" font-family="Times,serif" font-size="14.00">End Session (0)</text>
</g>
<g id="edge13" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M629.3,-250C580.26,-247.2 515.37,-246.72 458.96,-257 449.51,-258.72 439.79,-261.33 430.33,-264.36"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="428.93,-261.14 420.58,-267.67 431.18,-267.77 428.93,-261.14"/>
<text text-anchor="middle" onclick="attr(evt)" x="534.46" y="-260.8" font-family="Times,serif" font-size="14.00">Delete a Resolved Todo (0)</text>
</g>
<g id="edge12" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M729.35,-292.86C746.29,-317.32 772.04,-348.21 802.93,-365 900.26,-417.91 938.64,-402 1049.42,-402 1049.42,-402 1049.42,-402 1766.4,-402 1872.93,-402 1903.74,-411.43 2004.89,-378 2019.78,-373.08 2034.83,-365.54 2048.44,-357.55"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="2050.43,-360.43 2057.16,-352.25 2046.8,-354.45 2050.43,-360.43"/>
<text text-anchor="middle" onclick="attr(evt)" x="1407.91" y="-405.8" font-family="Times,serif" font-size="14.00">Activate a Resolved Todo (0)</text>
</g>
<g id="edge25" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M674.57,-291.4C674.4,-303.09 685.03,-312.48 706.44,-312.48 721.17,-312.48 730.79,-308.04 735.31,-301.47"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="738.81,-301.98 738.32,-291.4 732.1,-299.98 738.81,-301.98"/>
<text text-anchor="middle" onclick="attr(evt)" x="706.44" y="-316.28" font-family="Times,serif" font-size="14.00">Delete an Active Todo (0)</text>
</g>
<g id="edge15" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M782.44,-266.38C789.36,-267.02 796.27,-267.58 802.93,-268 1027.46,-282.22 1088.43,-297.75 1308.91,-253 1317.3,-251.3 1325.98,-249.15 1334.55,-246.77"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1335.52,-250.13 1344.17,-244.01 1333.59,-243.41 1335.52,-250.13"/>
<text text-anchor="middle" onclick="attr(evt)" x="1050.42" y="-285.8" font-family="Times,serif" font-size="14.00">Add an Active Todo (0)</text>
</g>
<g id="node6" class="node">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.2</title>
<ellipse fill="#f7f5eb" onclick="attr(evt)" stroke="black" cx="1050.42" cy="-184" rx="78.48" ry="37.45"/>
<text text-anchor="middle" onclick="attr(evt)" x="1050.42" y="-195.3" font-family="Times,serif" font-size="14.00">InSession.True</text>
<text text-anchor="middle" onclick="attr(evt)" x="1050.42" y="-180.3" font-family="Times,serif" font-size="14.00">ActiveTodos.0</text>
<text text-anchor="middle" onclick="attr(evt)" x="1050.42" y="-165.3" font-family="Times,serif" font-size="14.00">ResolvedTodos.2</text>
</g>
<g id="edge14" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.2</title>
<path fill="none" stroke="black" d="M741.5,-223.36C758.48,-208.92 780.21,-193.62 802.93,-186 854.92,-168.56 916.62,-168.07 965.28,-171.94"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="965.19,-175.45 975.46,-172.83 965.8,-168.48 965.19,-175.45"/>
<text text-anchor="middle" onclick="attr(evt)" x="878.43" y="-189.8" font-family="Times,serif" font-size="14.00">Add a Resolved Todo (0)</text>
</g>
<g id="edge8" class="edge">
<title>InSession.True, ActiveTodos.2, ResolvedTodos.0&#45;&gt;InSession.False, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M1686.73,-65.34C1614.71,-65.63 1504.57,-66 1408.91,-66 361.47,-66 361.47,-66 361.47,-66 282.61,-66 196.97,-98.34 141.01,-124.25"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="139.51,-121.09 131.95,-128.51 142.49,-127.42 139.51,-121.09"/>
<text text-anchor="middle" onclick="attr(evt)" x="878.43" y="-69.8" font-family="Times,serif" font-size="14.00">End Session (0)</text>
</g>
<g id="edge10" class="edge">
<title>InSession.True, ActiveTodos.2, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M1834.56,-82.77C1885.81,-98.78 1955.41,-126.43 2004.89,-169 2038.57,-197.98 2064.36,-241.84 2080.59,-275.01"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="2077.45,-276.54 2084.92,-284.06 2083.76,-273.52 2077.45,-276.54"/>
<text text-anchor="middle" onclick="attr(evt)" x="1933.39" y="-172.8" font-family="Times,serif" font-size="14.00">Delete an Active Todo (0)</text>
</g>
<g id="edge26" class="edge">
<title>InSession.True, ActiveTodos.2, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.2, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M1757.67,-102.34C1758.04,-112.62 1760.62,-120.48 1765.4,-120.48 1768.39,-120.48 1770.52,-117.41 1771.78,-112.59"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1775.3,-112.71 1773.13,-102.34 1768.36,-111.79 1775.3,-112.71"/>
<text text-anchor="middle" onclick="attr(evt)" x="1765.4" y="-124.28" font-family="Times,serif" font-size="14.00">Delete a Resolved Todo (0)</text>
</g>
<g id="edge27" class="edge">
<title>InSession.True, ActiveTodos.2, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.2, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M1750.38,-102.05C1748.07,-121.21 1753.08,-138.48 1765.4,-138.48 1775.51,-138.48 1780.69,-126.86 1780.95,-112.11"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1784.44,-111.85 1780.42,-102.05 1777.45,-112.22 1784.44,-111.85"/>
<text text-anchor="middle" onclick="attr(evt)" x="1765.4" y="-142.28" font-family="Times,serif" font-size="14.00">Activate a Resolved Todo (0)</text>
</g>
<g id="edge31" class="edge">
<title>InSession.True, ActiveTodos.2, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.2, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M1744.81,-101.63C1737.63,-128.95 1744.49,-156.48 1765.4,-156.48 1783.78,-156.48 1791.31,-135.21 1787.98,-111.52"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1791.39,-110.74 1785.99,-101.63 1784.53,-112.13 1791.39,-110.74"/>
<text text-anchor="middle" onclick="attr(evt)" x="1765.4" y="-160.28" font-family="Times,serif" font-size="14.00">Edit a Todo (0)</text>
</g>
<g id="edge32" class="edge">
<title>InSession.True, ActiveTodos.2, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.2, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M1740.78,-100.6C1726.96,-135.74 1735.17,-174.48 1765.4,-174.48 1792.92,-174.48 1802.19,-142.39 1793.21,-110.13"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1796.52,-108.97 1790.02,-100.6 1789.88,-111.19 1796.52,-108.97"/>
<text text-anchor="middle" onclick="attr(evt)" x="1765.4" y="-178.28" font-family="Times,serif" font-size="14.00">Add an Active Todo (0)</text>
</g>
<g id="edge9" class="edge">
<title>InSession.True, ActiveTodos.2, ResolvedTodos.0&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M1691.74,-78.24C1638.43,-89.86 1565.45,-109.86 1506.91,-141 1486.81,-151.69 1467.01,-166.91 1450.51,-181.28"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1447.84,-178.98 1442.7,-188.24 1452.49,-184.2 1447.84,-178.98"/>
<text text-anchor="middle" onclick="attr(evt)" x="1587.91" y="-144.8" font-family="Times,serif" font-size="14.00">Resolve an Active Todo (0)</text>
</g>
<g id="edge3" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.1&#45;&gt;InSession.False, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M1357.43,-193.09C1342.24,-185.08 1325.21,-176.96 1308.91,-171 1198.74,-130.7 1168.73,-113 1051.42,-113 361.47,-113 361.47,-113 361.47,-113 292.56,-113 215.26,-125.7 159.04,-137.3"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="158.22,-133.9 149.15,-139.38 159.65,-140.75 158.22,-133.9"/>
<text text-anchor="middle" onclick="attr(evt)" x="706.44" y="-116.8" font-family="Times,serif" font-size="14.00">End Session (0)</text>
</g>
<g id="edge6" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M1449.51,-254.14C1466.32,-265.67 1486.61,-277.43 1506.91,-284 1680.12,-340.09 1896.33,-336.46 2014.09,-328.77"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="2014.4,-332.26 2024.14,-328.09 2013.92,-325.27 2014.4,-332.26"/>
<text text-anchor="middle" onclick="attr(evt)" x="1765.4" y="-335.8" font-family="Times,serif" font-size="14.00">Delete a Resolved Todo (0)</text>
</g>
<g id="edge7" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M1332.07,-231.82C1324.26,-232.65 1316.43,-233.4 1308.91,-234 1126.66,-248.62 912.57,-254 795.3,-255.94"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="794.89,-252.45 784.95,-256.11 795,-259.44 794.89,-252.45"/>
<text text-anchor="middle" onclick="attr(evt)" x="1050.42" y="-254.8" font-family="Times,serif" font-size="14.00">Delete an Active Todo (0)</text>
</g>
<g id="edge5" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.2, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M1485.15,-214.91C1539.21,-207.32 1611.96,-191.74 1668.91,-160 1692.32,-146.95 1713.92,-126.54 1730.62,-107.98"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1733.51,-109.99 1737.47,-100.16 1728.25,-105.38 1733.51,-109.99"/>
<text text-anchor="middle" onclick="attr(evt)" x="1587.91" y="-213.8" font-family="Times,serif" font-size="14.00">Activate a Resolved Todo (0)</text>
</g>
<g id="edge33" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M1374.18,-255.86C1373.64,-267.79 1384.88,-277.48 1407.91,-277.48 1424.1,-277.48 1434.47,-272.69 1439.01,-265.7"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1442.44,-266.42 1441.64,-255.86 1435.67,-264.61 1442.44,-266.42"/>
<text text-anchor="middle" onclick="attr(evt)" x="1407.91" y="-281.28" font-family="Times,serif" font-size="14.00">Add a Resolved Todo (0)</text>
</g>
<g id="edge4" class="edge">
<title>InSession.True, ActiveTodos.1, ResolvedTodos.1&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.2</title>
<path fill="none" stroke="black" d="M1329.95,-217.14C1278.11,-213.46 1208.26,-207.72 1146.91,-200 1142.78,-199.48 1138.56,-198.91 1134.3,-198.31"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1134.72,-194.83 1124.32,-196.84 1133.71,-201.76 1134.72,-194.83"/>
<text text-anchor="middle" onclick="attr(evt)" x="1227.91" y="-218.8" font-family="Times,serif" font-size="14.00">Resolve an Active Todo (0)</text>
</g>
<g id="edge0" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.2&#45;&gt;InSession.False, ActiveTodos.0, ResolvedTodos.0</title>
<path fill="none" stroke="black" d="M975.76,-172.23C968.4,-171.34 961.03,-170.57 953.93,-170 666.65,-146.74 324.59,-150.28 166.97,-153.66"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="166.77,-150.16 156.85,-153.88 166.93,-157.16 166.77,-150.16"/>
<text text-anchor="middle" onclick="attr(evt)" x="534.46" y="-156.8" font-family="Times,serif" font-size="14.00">End Session (0)</text>
</g>
<g id="edge2" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.2&#45;&gt;InSession.True, ActiveTodos.0, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M979.39,-199.95C970.83,-201.74 962.19,-203.46 953.93,-205 887.19,-217.41 869.14,-212.99 802.93,-228 795.96,-229.58 788.76,-231.4 781.58,-233.35"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="780.52,-230.02 771.83,-236.08 782.4,-236.76 780.52,-230.02"/>
<text text-anchor="middle" onclick="attr(evt)" x="878.43" y="-231.8" font-family="Times,serif" font-size="14.00">Delete a Resolved Todo (0)</text>
</g>
<g id="edge1" class="edge">
<title>InSession.True, ActiveTodos.0, ResolvedTodos.2&#45;&gt;InSession.True, ActiveTodos.1, ResolvedTodos.1</title>
<path fill="none" stroke="black" d="M1127.85,-177.23C1179.43,-174.38 1248.79,-173.91 1308.91,-185 1319.21,-186.9 1329.84,-189.82 1340.12,-193.2"/>
<polygon fill="black" onclick="attr(evt)" stroke="black" points="1339.26,-196.61 1349.85,-196.57 1341.55,-189.99 1339.26,-196.61"/>
<text text-anchor="middle" onclick="attr(evt)" x="1227.91" y="-188.8" font-family="Times,serif" font-size="14.00">Activate a Resolved Todo (0)</text>
</g>
</g>
</svg>
            </td>
		</tr>
	</table>
</td>
</tr>
<tr>
    <td colspan="2" height="23px">
        <table width="100%">
            <tr>
                <td style="text-align:center; width: 25%"><label id="transitionFloor"></label></td>
                <td style="text-align:center; width: 18%"><button onclick="fitGraph()">FIT GRAPH</button></td>
                <td style="text-align:center; width: 25%"><button id="btnReset" onclick="reset()">RESET TRAVERSAL</button></td>
                <td style="text-align:center; width: 32%"><input type="checkbox" id="recycleCbox" name="recycleCBox" value="recycleColors"><label for="recycleCbox"> Recycle hitcount colors</label></td>
            </tr>
        </table>
    </td>
</tr>
<tr>
	<td colspan="2" height="63px">
		<table width="100%">
			<tr>
				<td></td>
			    <td id="transitionBox" style="width: 140px">
			    	<table border="1" rules="none">
			    		<tr>
			    			<td style="text-align: center; padding-top: 5px; height: 19px" colspan="3">Transition</td>
			    		</tr>
			    		<tr>
			    			<td style="padding-bottom: 7px; padding-left: 3px"><button onclick="traversalStepBack()">&lt;</button></td>
							<td id="stepTD" style="padding-bottom: 8px; text-align:center"><label id="step"></label></td>
						    <td style="padding-bottom: 7px; padding-right: 3px; text-align: right"><button onclick="traversalStepForward()">&gt;</button></td>
						</tr>
					</table>
				</td>
				<td></td>
				<td style="width: 264px">
					<table border="1" rules="none">
						<tr>
                            <td style="padding-top: 11px; padding-left: 7px; text-align: left; height: 19px">1</td>
							<td style="padding-top: 5px; text-align: center; height: 19px"><label id="speedLabel">Speed: 1</label></td>
                            <td style="padding-top: 5px; text-align: center; height: 19px"><button id="playPause" onclick="startTraversal()">&#9654;</button></td>
                            <td style="padding-top: 11px; padding-right: 5px; text-align: right; height: 19px">60</td>
						    <!--td style="text-align:right; padding-top:5px; padding-right:20px"><button onclick="stopTraversal()">&#9209;</button></td -->
						</tr>
			    		<tr>
							<td style="padding-bottom: 3px; padding-top: 0px; padding-left: 2px; padding-right: 2px" colspan="4"><input type="range" min="1" max="60" oninput="changeSpeed()" value="60" id="traversalSpeed"></td>
						</tr>
					</table>
				</td>
				<td></td>
				<td style="width: 264px">
					<table border="1" rules="none">
						<tr>
                            <td style="padding-top: 7px; text-align: center"><input type="checkbox" onclick="updateDisplayAttributes()" id="isolateSubgraph"><label for="isolateSubgraph"> Isolate subgraph</label></td>
						</tr>
						<tr>
							<td style="padding-bottom: 7px"><input type="range" min="0" max="60" oninput="updateDisplayAttributes()" value="20" id="subgraphOpacity"></td>
						</tr>
					</table>
				</td>
				<td></td>
		    </tr>
		</table>
	</td>
</tr>
<tr>
    <td id="debugInfo" colspan="2">
    </td>
</tr>
</table>
<script type="text/ecmascript">

var step = -1; // Because step is an index into an array.

const actionNames = ["End Session","Activate a Resolved Todo","Delete a Resolved Todo","Resolve an Active Todo","Delete an Active Todo","Add a Resolved Todo","Add an Active Todo","Start Session","Get Todos List","Get a Todo","Edit a Todo"];
 
const transitionActions = [0,1,2,0,3,1,2,4,0,3,4,0,1,2,5,6,0,3,4,5,6,0,5,6,7,4,2,1,3,8,9,10,6,5];
 
const transitionEnabledFlags = [true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true,true];
 
const transitionHitCounts = new Array(34).fill(0);
 
const nodeCount = 7;
 
const highestCoverageFloor = 3;
 
const traversedEdge = [24,22,15,7,11,24,23,20,31,9,6,18,30,28,21,24,22,15,5,10,17,13,23,20,8,24,22,15,4,0,24,22,14,2,25,12,19,3,24,23,29,16,24,22,15,33,5,32,27,26,9,4,1,6,19,3,24,23,20,32,10,17,25,14,1,33,7,13,21,24,22,11,24,23,20,26,31,27,8,24,23,16,24,22,12,29,18,28,30,22,14,2,14,0,24,23,17,13,21,24,22,11,24,23,20,27,32,31,26,8,24,23,18,28,30,22,15,3,24,22,14,0,24,22,15,6,16,24,23,29,19,33,7,12,17,25,14,1,5,9,4,2,12,20,10];
 
const pathEdges = [[24],[22],[15],[7],[11],[24,23,20,31],[24,23,20,31],[24,23,20,31],[24,23,20,31],[9],[6],[18],[30],[28],[21],[24,22,15,5],[24,22,15,5],[24,22,15,5],[24,22,15,5],[10],[17],[13],[23,20,8],[23,20,8],[23,20,8],[24,22,15,4],[24,22,15,4],[24,22,15,4],[24,22,15,4],[0],[24,22,14],[24,22,14],[24,22,14],[2],[25],[12],[19],[3],[24,23,29],[24,23,29],[24,23,29],[16],[24,22,15,33],[24,22,15,33],[24,22,15,33],[24,22,15,33],[5,32],[5,32],[27],[26],[9,4,1],[9,4,1],[9,4,1],[6],[19],[3],[24,23,20,32],[24,23,20,32],[24,23,20,32],[24,23,20,32],[10],[17],[25],[14],[1],[33],[7],[13],[21],[24,22,11],[24,22,11],[24,22,11],[24,23,20,26],[24,23,20,26],[24,23,20,26],[24,23,20,26],[31],[27],[8],[24,23,16],[24,23,16],[24,23,16],[24,22,12],[24,22,12],[24,22,12],[29],[18],[28],[30],[22,14,2],[22,14,2],[22,14,2],[14,0],[14,0],[24,23,17],[24,23,17],[24,23,17],[13],[21],[24,22,11],[24,22,11],[24,22,11],[24,23,20,27],[24,23,20,27],[24,23,20,27],[24,23,20,27],[32],[31],[26],[8],[24,23,18],[24,23,18],[24,23,18],[28],[30],[22,15,3],[22,15,3],[22,15,3],[24,22,14,0],[24,22,14,0],[24,22,14,0],[24,22,14,0],[24,22,15,6],[24,22,15,6],[24,22,15,6],[24,22,15,6],[16],[24,23,29],[24,23,29],[24,23,29],[19],[33],[7],[12],[17,25],[17,25],[14,1],[14,1],[5],[9],[4],[2],[12,20,10],[12,20,10],[12,20,10]];
 
const pathNodes = [[1],[3],[5],[3],[0],[0,1,2,4,4],[0,1,2,4,4],[0,1,2,4,4],[0,1,2,4,4],[5],[2],[1],[1],[1],[0],[0,1,3,5,4],[0,1,3,5,4],[0,1,3,5,4],[0,1,3,5,4],[2],[3],[1],[1,2,4,0],[1,2,4,0],[1,2,4,0],[0,1,3,5,6],[0,1,3,5,6],[0,1,3,5,6],[0,1,3,5,6],[0],[0,1,3,6],[0,1,3,6],[0,1,3,6],[3],[3],[2],[5],[0],[0,1,2,2],[0,1,2,2],[0,1,2,2],[0],[0,1,3,5,5],[0,1,3,5,5],[0,1,3,5,5],[0,1,3,5,5],[5,4,4],[5,4,4],[4],[4],[4,5,6,5],[4,5,6,5],[4,5,6,5],[2],[5],[0],[0,1,2,4,4],[0,1,2,4,4],[0,1,2,4,4],[0,1,2,4,4],[2],[3],[3],[6],[5],[5],[3],[1],[0],[0,1,3,0],[0,1,3,0],[0,1,3,0],[0,1,2,4,4],[0,1,2,4,4],[0,1,2,4,4],[0,1,2,4,4],[4],[4],[0],[0,1,2,0],[0,1,2,0],[0,1,2,0],[0,1,3,2],[0,1,3,2],[0,1,3,2],[2],[1],[1],[1],[1,3,6,3],[1,3,6,3],[1,3,6,3],[3,6,0],[3,6,0],[0,1,2,3],[0,1,2,3],[0,1,2,3],[1],[0],[0,1,3,0],[0,1,3,0],[0,1,3,0],[0,1,2,4,4],[0,1,2,4,4],[0,1,2,4,4],[0,1,2,4,4],[4],[4],[4],[0],[0,1,2,1],[0,1,2,1],[0,1,2,1],[1],[1],[1,3,5,0],[1,3,5,0],[1,3,5,0],[0,1,3,6,0],[0,1,3,6,0],[0,1,3,6,0],[0,1,3,6,0],[0,1,3,5,2],[0,1,3,5,2],[0,1,3,5,2],[0,1,3,5,2],[0],[0,1,2,2],[0,1,2,2],[0,1,2,2],[5],[5],[3],[2],[2,3,3],[2,3,3],[3,6,5],[3,6,5],[4],[5],[6],[3],[3,2,4,2],[3,2,4,2],[3,2,4,2]];
 
const startNode = [0,1,3,5,3,0,1,2,4,4,5,2,1,1,1,0,1,3,5,4,2,3,1,2,4,0,1,3,5,6,0,1,3,6,3,3,2,5,0,1,2,2,0,1,3,5,5,4,4,4,4,5,6,5,2,5,0,1,2,4,4,2,3,3,6,5,5,3,1,0,1,3,0,1,2,4,4,4,4,0,1,2,0,1,3,2,2,1,1,1,3,6,3,6,0,1,2,3,1,0,1,3,0,1,2,4,4,4,4,4,0,1,2,1,1,1,3,5,0,1,3,6,0,1,3,5,2,0,1,2,2,5,5,3,2,3,3,6,5,4,5,6,3,2,4];
 
const pathEndNode = [1,3,5,3,0,4,4,4,4,5,2,1,1,1,0,4,4,4,4,2,3,1,0,0,0,6,6,6,6,0,6,6,6,3,3,2,5,0,2,2,2,0,5,5,5,5,4,4,4,4,5,5,5,2,5,0,4,4,4,4,2,3,3,6,5,5,3,1,0,0,0,0,4,4,4,4,4,4,0,0,0,0,2,2,2,2,1,1,1,3,3,3,0,0,3,3,3,1,0,0,0,0,4,4,4,4,4,4,4,0,1,1,1,1,1,0,0,0,0,0,0,0,2,2,2,2,0,2,2,2,5,5,3,2,3,3,5,5,4,5,6,3,2,2,2];
 
const subgraphNodes = [[0,6,5,4,3,2,1],[1,3,2,0],[2,5,4,3,0,1],[3,6,5,0,2,1],[4,5,0,2],[5,6,0,4,2,3],[6,0,5,3]];
 
const subgraphEdges = [[0,3,8,11,16,21,24],[13,18,21,22,23,24,28,30],[6,10,12,16,17,18,19,20,23,29],[2,7,11,12,13,14,15,17,22,25],[5,8,9,10,20,26,27,31,32],[1,3,4,5,6,7,9,15,19,33],[0,1,2,4,14]];
 
var c = 0;
var t;
var timer_is_on = 0;

var coverageFloor;

var mbrL = 1000000000.0;
var mbrT = 1000000000.0;
var mbrR = -100000000.0;
var mbrB = -100000000.0;

for (var i=0; i < nodeCount; i++)
{
    var bbox = document.getElementById("node" + i).getBBox();
    mbrL = bbox.x < mbrL ? bbox.x : mbrL;
    mbrT = bbox.y < mbrT ? bbox.y : mbrT;
    var R = bbox.x + bbox.width;
    mbrR = R > mbrR ? R : mbrR;
    var B = bbox.y + bbox.height;
    mbrB = B > mbrB ? B : mbrB; 
}

for (var i=0; i < transitionHitCounts.length; i++)
{
    var bbox = document.getElementById("edge" + i).getBBox();
    mbrL = bbox.x < mbrL ? bbox.x : mbrL;
    mbrT = bbox.y < mbrT ? bbox.y : mbrT;
    var R = bbox.x + bbox.width;
    mbrR = R > mbrR ? R : mbrR;
    var B = bbox.y + bbox.height;
    mbrB = B > mbrB ? B : mbrB; 
}

var mbrW = mbrR - mbrL;
var mbrH = mbrT - mbrB;
// add a margin to the MBR
var mbrMargin = 0.01*mbrW;
mbrL -= mbrMargin;
mbrR += mbrMargin;
mbrMargin = 0.01*mbrH;
mbrT -= mbrMargin;
mbrB += mbrMargin;
mbrW = mbrR - mbrL;
mbrH = mbrT - mbrB;
mbrL = mbrL.toFixed(2);
mbrR = mbrR.toFixed(2);
mbrT = mbrT.toFixed(2);
mbrB = mbrB.toFixed(2);
mbrW = mbrW.toFixed(2);
mbrH = mbrH.toFixed(2);

var initialBox = mbrL.toString() + " " + mbrT.toString() + " " + mbrW.toString() + " " + mbrH.toString(); // svgOuter.getAttribute("viewBox");
var initialBits = initialBox.split(" ");

const stepElemSize = 18*Math.floor(Math.log10(traversedEdge.length)) + 27;
var stepElem = document.getElementById("stepTD");
stepElem.setAttribute("style", "text-align:center; width: " + stepElemSize.toString() + "px");
document.getElementById("transitionBox").setAttribute("style", "width: " + (stepElemSize + 60) + "px");
setStepText();
assessCoverageFloor();

var selectedSvgElement = undefined;

for (var j=0; j < transitionActions.length; j++)
{
    var action = actionNames[transitionActions[j]];
    var text = document.getElementById("edge" + j.toString()).getElementsByTagName("text");
    if (text.length > 0)
    {
        text[0].innerHTML = action;
    }
}

function changeSpeed(e) {
	document.getElementById("speedLabel").innerHTML = "Speed: " + document.getElementById("traversalSpeed").value.toString();
}

function fitGraph() {
    newBits = originalBits;
    svgRescale = 1.0;
    translateScale = newBits[2] / originalBits[2];
    document.getElementById("svgOuter").setAttribute("viewBox", initialBox);
}

var previousSubgraph = undefined;
var previousFill = undefined;
var currentSubgraph = undefined;

function edgeOpacityAndEvents(edgeId, opacity) {
	var edge = document.getElementById(edgeId);
	edge.setAttribute("opacity", opacity);
	var text = edge.getElementsByTagName("text");
	var path = edge.getElementsByTagName("path");
	var poly = edge.getElementsByTagName("polygon");
	if (opacity == "1.0")
	{
	    edge.setAttribute("opacity", "1.0");
	    if (text.length > 0)
	    {
	    	text[0].addEventListener("click", attr);
	    }
	    if (poly.length > 0)
	    {
	    	poly[0].addEventListener("click", attr);
	    }
	    if (path.length > 0)
	    {
	    	path[0].addEventListener("click", attr);
	    }
	}
	else
	{
	    edge.setAttribute("opacity", opacity);
	    if (text.length > 0)
	    {
	    	text[0].removeEventListener("click", attr);
	    }
	    if (poly.length > 0)
	    {
	    	poly[0].removeEventListener("click", attr);
	    }
	    if (path.length > 0)
	    {
	    	path[0].removeEventListener("click", attr);
	    }
	}
}

function nodeOpacityAndEvents(nodeId, opacity) {
	var node = document.getElementById(nodeId);
	node.setAttribute("opacity", opacity);
    var text = node.getElementsByTagName("text");
    var ellipse = node.getElementsByTagName("ellipse");
    if (opacity == "1.0")
    {
        node.setAttribute("opacity", "1.0");
        if (text.length > 0)
        {
            for (var i=0; i < text.length; i++)
            {
            	text[i].addEventListener("click", attr);
            }
        }
        if (ellipse.length > 0)
        {
        	ellipse[0].addEventListener("click", attr);
        }
    }
    else
    {
        node.setAttribute("opacity", opacity);
        if (text.length > 0)
        {
            for (var i=0; i < text.length; i++)
            {
            	text[i].removeEventListener("click", attr);
            }
        }
        if (ellipse.length > 0)
        {
        	ellipse[0].removeEventListener("click", attr);
        }
    }
}

function allComponentsToFullOpacity() {
    for (var i=0; i < transitionHitCounts.length; i++)
    {
        edgeOpacityAndEvents("edge" + i, "1.0");
    }
    for (var i=0; i < nodeCount; i++)
    {
        nodeOpacityAndEvents("node" + i, "1.0");
    }
}

function updateDisplayAttributes() {
    if (currentSubgraph == undefined || !document.getElementById("isolateSubgraph").checked)
    {
    	if (previousSubgraph != undefined)
    	{
	    	var ellipse = document.getElementById("node" + previousSubgraph).getElementsByTagName("ellipse")[0];
	    	ellipse.setAttribute("fill", previousFill);
		}
		allComponentsToFullOpacity();
    }

    if (document.getElementById("isolateSubgraph").checked && currentSubgraph != undefined)
    {
    	var opacityValue = document.getElementById("subgraphOpacity").value / 100.0;
    	var opacityString = opacityValue.toString();

        for (var i=0; i < transitionHitCounts.length; i++)
        {
    		edgeOpacityAndEvents("edge" + i, subgraphEdges[currentSubgraph].includes(i) ? "1.0" : opacityString);
        }
        for (var i=0; i < nodeCount; i++)
        {
        	nodeOpacityAndEvents("node" + i, subgraphNodes[currentSubgraph].includes(i) ? "1.0" : opacityString);
        }

        if (previousSubgraph != undefined)
        {
	        var ellipse = document.getElementById("node" + previousSubgraph).getElementsByTagName("ellipse")[0];
	        ellipse.setAttribute("fill", previousFill);
	    }
        previousSubgraph = subgraphNodes[currentSubgraph][0];
        var ellipse = document.getElementById("node" + previousSubgraph).getElementsByTagName("ellipse")[0];
        previousFill = ellipse.getAttribute("fill");
        ellipse.setAttribute("fill", "#ffff77");
    }
}

function releaseSelection() {
	if (currentSubgraph != undefined)
	{
        currentSubgraph = undefined;
    }
    updateDisplayAttributes();

    if (selectedSvgElement != undefined)
    {
        var text = selectedSvgElement.getElementsByTagName("text");
        if (text && text.length > 0)
        {
            for (var i = 0; i < text.length; i++)
            {
                text[i].setAttribute("fill", "black");
            }
        }
        document.getElementById("selectedSvgElementInfo").innerHTML = " ";
        selectedSvgElement = undefined;
    }
}

function attr(event) {
    releaseSelection();
    var t = event.target;
    var p = t.parentNode;
    selectedSvgElement = p;
    var id = p.getAttribute("id");
    var msg = "";

    switch (id.substring(0,4))
    {
        case "node":
        	var nodenum = id.substring(4);
        	if (currentSubgraph != undefined)
        	{
        		if (currentSubgraph == nodenum)
        		{
        			return;
        		}
        	}
            currentSubgraph = nodenum;
            updateDisplayAttributes();
            var title = p.getElementsByTagName("title");
            if (title && title.length > 0)
            {
                msg += title[0].innerHTML;
            }
            var text = p.getElementsByTagName("text");
            if (text && text.length > 0)
            {
                for (var i=0; i<text.length; i++)
                {
                    text[i].setAttribute("fill", "red");
                }
            }
            break;
        case "edge":
            var text = p.getElementsByTagName("text");
            if (text && text.length > 0)
            {
                msg += text[0].innerHTML;
                text[0].setAttribute("fill", "red");
            }
            break;
        default:
            break;
    }

    document.getElementById("selectedSvgElementInfo").innerHTML = msg;
}

var viewBoxBits = document.getElementById("svgOuter").getAttribute("viewBox").split(" ");
var originalBits = [parseFloat(viewBoxBits[0]), parseFloat(viewBoxBits[1]),
    parseFloat(viewBoxBits[2]), parseFloat(viewBoxBits[3])];
var newBits = originalBits;
var translateScale = newBits[2] / originalBits[2];

function svgMouseDown(event) {
    var t = event.target;
    switch (event.button)
    {
        case 0: // main button, e.g., left on a default setup
            t.onmousemove = svgMouseMove;
            didTranslate = false;
            break;
        case 1: // mouse wheel
            break;
        case 2: // secondary button, e.g., right on a default setup
            break;
        default: // we don't interepret any other mouse buttons, yet
            break;
    }
    // https://www.javascripttutorial.net/javascript-dom/javascript-mouse-events/
}

var mouseMovePreviousX = undefined;
var mouseMovePreviousY = undefined;
var didTranslate = false;

function svgMouseMove(event) {
    didTranslate = true;
    var t = event.target;
    var x = event.clientX;
    var y = event.clientY;
    if (mouseMovePreviousX == undefined || mouseMovePreviousY == undefined)
    {
        mouseMovePreviousX = x;
        mouseMovePreviousY = y;
    }
    else
    {
        var dx = translateScale * 0.9 * (mouseMovePreviousX - x);
        var dy = translateScale * 0.9 * (mouseMovePreviousY - y);
        mouseMovePreviousX = x;
        mouseMovePreviousY = y;
        translateViewBox(dx, dy);
    }
}

var svgRescale = 1.0;
var previousDeltaWasPositive = true;

function svgMouseWheel(event) {
    didTranslate = true;
    zoomGraph(event.deltaY);
}

function zoomGraph(delta) {
    if (delta > 0)
    {
    	if (previousDeltaWasPositive)
    	{
	    	svgRescale *= 1.01;
	    }
	    else
	    {
	    	svgRescale = 1.01;
	    }
	    previousDeltaWasPositive = true;
    }
    else
    {
    	if (previousDeltaWasPositive)
    	{
    		svgRescale = 0.99;
    	}
    	else
    	{
    		svgRescale *= 0.99;
    	}
    	previousDeltaWasPositive = false;
    }

    newBox = rescaleViewBox( svgRescale );
}

function svgMouseLeave(event) {
    svgMouseChange(event);
}

function svgMouseUp(event) {
    if (!didTranslate && selectedSvgElement != undefined)
    {
        releaseSelection();
    }
    svgMouseChange(event);
}

function svgMouseChange(event) {
	svgRescale = 1.0;
    didTranslate = false;
    mouseMovePreviousX = undefined;
    mouseMovePreviousY = undefined;
    var t = event.target;
    t.onmousemove = null;
}

function rescaleViewBox(scale) {
    var svgOuter = document.getElementById("svgOuter");
    var viewBox = svgOuter.getAttribute("viewBox");
    var boxBits = viewBox.split(" ");
    var width = parseFloat(boxBits[2]);
    var height = parseFloat(boxBits[3]);
    var xMin = parseFloat(boxBits[0]);
    var yMin = parseFloat(boxBits[1]);

    if (Math.abs(scale - 1.0) < 0.001)
    {
        // do nothing on an almost nothing scale change.
        return;
    }

    xMin += 0.5 * (1.0 - scale) * width;
    yMin += 0.5 * (1.0 - scale) * height;
    width *= scale;
    height *= scale;

    if (width < 60 || height < 40 || width > mbrW || Math.abs(height) > Math.abs(mbrH))
    {
        return viewBox;
    }

    newBits = [xMin, yMin, width, height];
    translateScale = newBits[2] / originalBits[2];
    var newViewBox = updateViewBox(xMin, yMin, width, height);
    return newViewBox;
}

function updateViewBox(xMin, yMin, width, height) {
    var xString = xMin.toFixed(2).toString();
    var yString = yMin.toFixed(2).toString();
    var wString = width.toFixed(2).toString();
    var hString = height.toFixed(2).toString();
    var newViewBox = xString + " " + yString + " " + wString + " " + hString;
    svgOuter.setAttribute("viewBox", newViewBox);
	return newViewBox;	
}

var bOuterWidth = false;

// https://stackoverflow.com/questions/10385768/how-do-you-resize-a-browser-window-so-that-the-inner-width-is-a-specific-value
var resizeViewPort = function(width, height) {
    var tmp = document.documentElement.style.overflow;
    document.documentElement.style.overflow = "scroll";

    if (window.outerWidth) {
    	bOuterWidth = true;
        window.resizeTo(
            width + (window.outerWidth - document.documentElement.clientWidth),
            height + (window.outerHeight - document.documentElement.clientHeight)
        );
    } else {
    	bOuterWidth = false;
        window.resizeTo(500, 500);
        window.resizeTo(
            width + (500 - document.documentElement.clientWidth),
            height + (500 - document.documentElement.clientHeight)
        );
    }

    document.documentElement.style.overflow = tmp;
};

function updateWindowDimensions() {
    var tmp = document.documentElement.style.overflow;
    document.documentElement.style.overflow = "scroll";
	var w = window.innerWidth;
	var h = window.innerHeight;
    document.documentElement.style.overflow = tmp;

// Do not shrink window below minimum size, else the GUI gets mangled 
    if ( w < 650 || h < 570 )
    {
        resizeViewPort(w < 650 ? 650 : w, h < 570 ? 570 : h);
        tmp = document.documentElement.style.overflow;
        document.documentElement.style.overflow = "scroll";
        w = window.innerWidth;
        h = window.innerHeight;
        document.documentElement.style.overflow = tmp;
    }

	var mainBox = document.getElementById("mainBox");

    var width = w - 54;
    var height = h - 190;
    mainBox.setAttribute("width", width.toString() + "px");
    mainBox.setAttribute("height", height.toString() + "px");
    var aspect = width/height;
    var originalAspect = originalBits[2]/originalBits[3];
    var newScale = aspect/originalAspect;

    if (aspect > originalAspect)
    {
    	var newWidth = newScale*newBits[2];
    	var delta = newWidth - newBits[2];
    	var newXmin = newBits[0] - 0.5*delta;
    	updateViewBox(newXmin, newBits[1], newWidth, newBits[3]);
    }
    else
    {
    	var newHeight = newBits[3]/newScale;
    	var delta = newHeight - newBits[3];
    	var newYmin = newBits[1] - 0.5*delta;
    	updateViewBox(newBits[0], newYmin, newBits[2], newHeight);
    }
    document.getElementById("debugInfo").innerHTML = "window " + w + "," + h + " box " + width + "," + height + " viewBox " + document.getElementById("svgOuter").getAttribute("viewBox") + " MBR " + mbrL + "," + mbrT + ": " + mbrR + "," + mbrB + ": " + mbrW + "," + mbrH + " outerWidth? " + (bOuterWidth ? "Yes" : "No");
}

updateWindowDimensions();
initialBox = document.getElementById("svgOuter").getAttribute("viewBox");

function translateViewBox(dx, dy) {
    var svgOuter = document.getElementById("svgOuter");
    var viewBox = svgOuter.getAttribute("viewBox");
    var boxBits = viewBox.split(" ");
    var xMin = parseFloat(boxBits[0]) + dx;
    var yMin = parseFloat(boxBits[1]) + dy;
    xString = xMin.toFixed(2).toString();
    yString = yMin.toFixed(2).toString();

    var newViewBox = xString + " " + yString + " " + boxBits[2] + " " + boxBits[3];
    svgOuter.setAttribute("viewBox", newViewBox);
}

function setTransitionFloorText() {
	document.getElementById("transitionFloor").innerHTML = "Hitcount floor: " + coverageFloor + "/" + highestCoverageFloor;
}

function timedTraversal() {
	c = c + 1;
	traversalStepForward();
	if (timer_is_on)
	{
		var dt = Math.round(1000.0 / parseFloat(document.getElementById("traversalSpeed").value));
        // If dt can handle it, reduce delay between steps by an estimated rendering time of 14 ms
        if (dt > 14)
        {
            dt -= 14;
        }
		t = setTimeout(timedTraversal, dt);
	}
}

function startTraversal() {
  var playPause = document.getElementById("playPause");
  playPause.removeEventListener("click", startTraversal);
  playPause.addEventListener("click", stopTraversal);
  playPause.innerHTML = "&#9208";
  if (!timer_is_on) {
    timer_is_on = 1;
    timedTraversal();
  }
}

function stopTraversal() {
  var playPause = document.getElementById("playPause");
  playPause.removeEventListener("click", stopTraversal);
  playPause.addEventListener("click", startTraversal);
  playPause.innerHTML = "&#9654";
  clearTimeout(t);
  timer_is_on = 0;
}

function reset() {
	timer_is_on = 0;
	clearTimeout(t);

    document.getElementById("selectedSvgElementInfo").innerHTML = " ";
    for (var i = 0; i < transitionHitCounts.length; i++)
    {
        transitionHitCounts[i] = 0;
    }
    refreshGraphics("black");

    step = -1; // Because step is an index into an array.
    setStepText();
    assessCoverageFloor();
}

function setStepText() {
	document.getElementById("step").innerHTML = (step+1) + "/" + traversedEdge.length;
}

function refreshGraphics(refreshColor) {
	// Walk backwards from the current step and set a 
	// rendered flag on each transition as it is encountered.
	// Do not render a transition that has rendered==true.
	var rendered = new Array(transitionHitCounts.length).fill(false);
//	for (var i=0; i < transitionHitCounts.length; i++)
//	{
//		rendered[i] = transitionHitCounts[i] == 0;
//	}

    var edgesToRender = transitionHitCounts.length;

    // Before we walk backwards, clear each edge of the lookahead path
    // that is beyond the present edge.
    var strokeString = Math.ceil(Math.log10(newBits[2]+newBits[3])*3.0).toString();

    if (step > -1 && step < traversedEdge.length)
    {
        for (var i=1; i < pathEdges[step].length; i++)
        {
            var index = pathEdges[step][i];
            var hitCount = transitionHitCounts[index];
	        var hitColor = getHitColor(hitCount);
	        var action = actionNames[index];

            rendered[index] = true;
            edgesToRender--;

            var edge = document.getElementById("edge" + index.toString());
            var path = edge.getElementsByTagName("path");
            if (path.length > 0)
            {
                path[0].setAttribute("stroke-width", hitCount == 0 ? 1 : strokeString);
                path[0].setAttribute("stroke", hitColor);
            }
            var poly = edge.getElementsByTagName("polygon");
            if (poly.length > 0)
            {
                poly[0].setAttribute("stroke-width", hitCount == 0 ? 1 : strokeString);
                poly[0].setAttribute("fill", hitColor);
                poly[0].setAttribute("stroke", hitColor);
            }
	        var text = edge.getElementsByTagName("text");
	        if (text.length > 0)
	        {
	            if (hitCount > 0)
	            {
	                action += " (" + hitCount.toString() + ")";
	            }
	            text[0].innerHTML = action;
	        }
        }
    }

    for (var i = step; i >= 0 && edgesToRender > 0; i--)
    {
    	var edgeIndex = traversedEdge[i];
    	if (rendered[edgeIndex])
    	{
    		continue;
    	}

        // When there are many steps, we will cover all the edges before we
        // get through all the steps, and we can stop looking for edges to
        // paint.  So count down the edges to render to zero, and stop.
        edgesToRender--; 

    	rendered[edgeIndex] = true;
        var hitCount = transitionHitCounts[edgeIndex];
        var hitColor = getHitColor(hitCount);
        var action = actionNames[transitionActions[edgeIndex]];
        var edge = document.getElementById("edge" + edgeIndex.toString());
        var path = edge.getElementsByTagName("path");
        if (path.length > 0)
        {   // for hitCount 0 set the stroke width to 1.
            path[0].setAttribute("stroke-width", hitCount == 0 ? 1 : refreshColor == null ? strokeString : "1");
            path[0].setAttribute("stroke", refreshColor == null ? hitColor : refreshColor);
        }
        var poly = edge.getElementsByTagName("polygon");
        if (poly.length > 0)
        {   // for hitCount 0 set the stroke width to 1.
            poly[0].setAttribute("stroke-width", hitCount == 0 ? 1 : refreshColor == null ? strokeString : "1");
            poly[0].setAttribute("fill", refreshColor == null ? hitColor : refreshColor);
            poly[0].setAttribute("stroke", refreshColor == null ? hitColor : refreshColor);
        }
        var text = edge.getElementsByTagName("text");
        if (text.length > 0)
        {
            if (hitCount > 0)
            {
                action += " (" + hitCount.toString() + ")";
            }
            text[0].innerHTML = action;
        }
    }

    // Clear all the nodes.
    for (var i = 0; i < nodeCount; i++)
    {
        var node = document.getElementById("node" + i.toString());
        var ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            ellipse[0].setAttribute("fill", "#f7f5eb");
        }
    }
}

function traversalStepBack() {
	stopTraversal();
    if (step - 1 < -1)
    {
        return;
    }

    if (step > -1)
    {
        transitionHitCounts[traversedEdge[step]]--;
        if (transitionEnabledFlags[traversedEdge[step]] && transitionHitCounts[traversedEdge[step]] < coverageFloor)
        {
        	coverageFloor = transitionHitCounts[traversedEdge[step]];
        	setTransitionFloorText();
        }
        refreshGraphics();
    }
    step--;
    traversalStepCommon();
}

function traversalStepForward() {
    if (step + 1 >= traversedEdge.length)
    {
        stopTraversal(); // in case the traversal was running.  Now we can use the back button.
        return;
    }
    step++;
    transitionHitCounts[traversedEdge[step]]++;
    refreshGraphics();
    assessCoverageFloor();
    traversalStepCommon();
}

window.addEventListener( 'keydown', (e) => { 
    var key = 0;


    if (e == null) { key = event.keyCode;}  
    else {  key = e.which;} 


    switch(key) {
        case 37: // left arrow
            stopTraversal();
            traversalStepBack();
            break;
        case 38: // up arrow
            zoomGraph(1.0);
            break;
        case 39: // right arrow
            stopTraversal();
            traversalStepForward();                     
            break;
        case 40: // down arrow
            zoomGraph(-1.0);
            break;
    }     
});

function assessCoverageFloor()
{
	var floor = 2000000000;
	for (var i=0; i < transitionHitCounts.length; i++)
	{
		if (transitionEnabledFlags[i] && transitionHitCounts[i] < floor)
		{
			floor = transitionHitCounts[i];
		}
	}
	if (floor != coverageFloor)
	{
		coverageFloor = floor;
		setTransitionFloorText();
	}
}

function traversalStepCommon() {
    setStepText();

    if (step == -1)
    {
        return; // no work to do because we are at the initial state.
    }

    document.getElementById("selectedSvgElementInfo").innerHTML = actionNames[transitionActions[traversedEdge[step]]];

    var strokeWidth = Math.ceil(Math.log10(newBits[2]+newBits[3])*15.0);

    // Now paint the current path and nodes in light grey
    for (var i = 0; i < pathEdges[step].length; i++)
    {
        var svgEdge = pathEdges[step][i];
        var edge = document.getElementById("edge" + svgEdge.toString());
        var path = edge.getElementsByTagName("path");
        if (path.length > 0)
        {
            path[0].setAttribute("stroke-width", strokeWidth.toString());
            path[0].setAttribute("stroke", "lightgrey");
        }
        var poly = edge.getElementsByTagName("polygon");
        if (poly.length > 0)
        {
            poly[0].setAttribute("stroke-width", strokeWidth.toString());
            poly[0].setAttribute("fill", "lightgrey");
            poly[0].setAttribute("stroke", "lightgrey");
        }
    }
    for (var i = 0; i < pathNodes[step].length; i++)
    {
        var svgNode = pathNodes[step][i];
        var node = document.getElementById("node" + svgNode.toString());
        var ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            ellipse[0].setAttribute("fill", "lightgrey");
        }
    }

    // Finally, paint the current transition
    svgEdge = traversedEdge[step];
    edge = document.getElementById("edge" + svgEdge.toString());
    var path = edge.getElementsByTagName("path");
    if (path.length > 0)
    {
        path[0].setAttribute("stroke-width", strokeWidth.toString());
        path[0].setAttribute("stroke", "url(#greenBlueGradient)");
    }
    var poly = edge.getElementsByTagName("polygon");
    if (poly.length > 0)
    {
        poly[0].setAttribute("stroke-width", strokeWidth.toString());
        poly[0].setAttribute("fill", "url(#greenBlueGradient)");
        poly[0].setAttribute("stroke", "url(#greenBlueGradient)");
    }

    if (startNode[step] == pathEndNode[step])
    {
    	var nodeNum = startNode[step];
    	var node = document.getElementById("node" + nodeNum.toString());

        var ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            if (pathEdges[step].length == 1)
            {
                // This is a self loop with the path coming out of the 
                // start node, going into the end node, so make the 
                // node blue to green.
                ellipse[0].setAttribute("fill", "url(#blueGreenGradient)");
            }
            else
            {
                // This is probably the path coming into the end node,
                // so make the node green to blue.
                ellipse[0].setAttribute("fill", "url(#greenBlueGradient)");

            }
        }
    }
    else
    {
        var start = startNode[step];
        var node = document.getElementById("node" + start.toString());
        var ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            ellipse[0].setAttribute("fill", "yellowgreen");
        }

        var pathEnd = pathEndNode[step];
        node = document.getElementById("node" + pathEnd.toString());
        ellipse = node.getElementsByTagName("ellipse");
        if (ellipse.length > 0)
        {
            ellipse[0].setAttribute("fill", "lightskyblue");
        }
    }
}

function getHitColor(hitCount) {
	var caseNum = document.getElementById("recycleCbox").checked ? hitCount%19 : hitCount;

    switch (caseNum)
    {
        case 0:
            if (hitCount != 0)
            {
                return "#FF7F7F";
            }
            return "#000000";
        case 1:
            return "#DF00DF";
        case 2:
            return "#00AFFF";
        case 3:
            return "#FFAF00";
        case 4:
            return "#00DF00";
        case 5:
            return "#0000DF";
        case 6:
            return "#EFD700";
        case 7:
            return "#8F008F";
        case 8:
            return "#77EF77";
        case 9:
            return "#3737AF";
        case 10:
            return "#BF4F4F";
        case 11:
            return "#008F00";
        case 12:
            return "#A71770";
        case 13:
            return "#3FAF3F";
        case 14:
            return "#4F7FEF";
        case 15:
            return "#8FCF27";
        case 16:
            return "#771FAF";
        case 17:
            return "#97FF2F";
        default:
            return "#FF7F7F";
    }
}
</script>
</body>
</html>
